import"node:stream";import{g as F,h as T,j as I,k as w,l as g,t as x,m as E,n as b,o as J,p as _,q as P}from"./ssr-DVrxIcU9.js";import{eventHandler as C}from"h3";import S from"redaxios";function O(e,s){const t=s;return F(t.url),Object.assign(async(a,i)=>t({method:e,payload:a||void 0,requestInit:i?.requestInit}),{url:s.url})}const h="server-fn-return-type",l="server-fn-payload-type";async function H(e,s,t){const a=s[0];if(T(a)&&a.method){const n=a,o=n.payload instanceof FormData?"formData":n.payload instanceof Request?"request":"payload",r=new Headers({[l]:o,...o==="payload"?{"content-type":"application/json",accept:"application/json"}:{},...n.requestInit?.headers instanceof Headers?Object.fromEntries(n.requestInit.headers.entries()):n.requestInit?.headers||{}});if(n.method==="GET"){const f=n.payload!==void 0?I({payload:n.payload}).substring(1):"";f&&(e+=`&${f}`)}const m=new Request(e,{...n.requestInit,method:n.method,headers:r,...n.method==="POST"?{body:o==="formData"?n.payload:JSON.stringify(n.payload??null)}:{}}),v=await t(m),u=await j(v);if(["rsc"].includes(u.headers.get(h)))return u.body;if(["json"].includes(u.headers.get(h))){const f=await u.text(),y=f?JSON.parse(f):void 0;if(w(y)||g(y))throw y;return y}return u}const i=new Request(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",[l]:"args"},body:JSON.stringify(s)}),d=await j(await t(i)),c=d.headers.get("content-type"),p=await d.text();return c&&c.includes("application/json")?p?JSON.parse(p):void 0:p}async function j(e){if(!e.ok){const s=await(async()=>{const t=e.headers.get("content-type");return t&&t.includes("application/json")?await e.json():await e.text()})();throw new Error([`Request failed with status ${e.status}`,`${JSON.stringify(s,null,2)}`].join(`

`))}return e}function q(e,s,t){return`${e}/_server/?_serverFnId=${encodeURI(s)}&_serverFnName=${encodeURI(t)}`}C(U);async function U(e){return N(x(e))}async function N(e,s){const t=e.method,a=new URL(e.url,"http://localhost:3000"),i=Object.fromEntries(new URLSearchParams(a.search).entries()),d=i._serverFnId,c=i._serverFnName;if(!d||!c)throw new Error("Invalid request");F(typeof d=="string");const p=(await E("server").chunks[d]?.import())?.[c],n=await(async()=>{try{const o=await(async()=>e.headers.get(l)==="payload"?[t.toLowerCase()==="get"?b(a.search)?.payload:await e.json(),{method:t,request:e}]:e.headers.get(l)==="formData"||e.headers.get("Content-Type")?.includes("multipart/form-data")?[t.toLowerCase()==="get"?(()=>{const{_serverFnId:m,_serverFnName:v,payload:u}=i;return u})():await e.formData(),{method:t,request:e}]:e.headers.get(l)==="request"?[e,{method:t,request:e}]:await e.json())(),r=await p(...o);return r instanceof Response?r:w(r)||g(r)?R(r):new Response(r!==void 0?JSON.stringify(r):void 0,{status:200,headers:{"Content-Type":"application/json",[h]:"json"}})}catch(o){return o instanceof Response?o:w(o)||g(o)?R(o):(console.error("Server Fn Error!"),console.error(o),console.info(),new Response(JSON.stringify(o),{status:500,headers:{"Content-Type":"application/json",[h]:"error"}}))}})();if(n.status===200&&n.headers.get("Content-Type")==="application/json"){const r=await n.clone().text();r&&JSON.stringify(JSON.parse(r))}return n}function R(e){return new Response(JSON.stringify(e),{headers:{"Content-Type":"application/json",[h]:"json",...e.headers||{}}})}function $(e,s,t){const a=q("http://localhost:3000",s,t);return Object.assign((...d)=>H(a,d,async c=>{const p=J(),n=_(p);return Object.entries(n).forEach(([o,r])=>{c.headers.has(o)||c.headers.append(o,r)}),N(c)}),{url:a})}const M=O("GET",$(D,"c_7865","$$function0")),W=O("GET",$(L,"c_7865","$$function1"));async function D(e){return console.info(`Fetching post with id ${e}...`),await S.get(`https://jsonplaceholder.typicode.com/posts/${e}`).then(t=>t.data).catch(t=>{throw console.error(t),t.status===404?P():t})}async function L(){return console.info("Fetching posts..."),S.get("https://jsonplaceholder.typicode.com/posts").then(e=>e.data.slice(0,10))}export{M as a,W as f};
